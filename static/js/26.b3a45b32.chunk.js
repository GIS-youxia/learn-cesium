(this["webpackJsonplearn-cesium"]=this["webpackJsonplearn-cesium"]||[]).push([[26],{130:function(e,t,r){"use strict";r.r(t),r.d(t,"Path",(function(){return F}));r(278);for(var a,n,i=r(280),o=r.n(i),c=r(271),s=r(250),l=r.n(s),u=r(270),d=r(252),p=r(86),b=r(87),v=r(88),h=r(89),m=r(11),w=r(85),g=r(279),f=r.n(g),y=r(24),C=300,M=20/C,x=[117.128202,36.209944],P=(a=w.b.Cartesian3).fromDegrees.apply(a,x),O=(n=w.b.Cartesian3).fromDegrees.apply(n,[117.109628,36.257021]),j=[],D=[],S=0;S<=C;++S){var k=S/C;j.push(w.b.Cartesian3.lerp(P,O,k,new w.b.Cartesian3))}function T(e,t){var r=f()(),a=r.clone().add(20,"s"),n=r.toISOString(),i=a.toISOString();return[{id:"document",name:"\u89c2\u5149\u8def\u7ebf",version:"1.0",clock:{interval:"".concat(n,"/").concat(i),currentTime:n,multiplier:1,range:"UNBOUNDED"}},{id:"path",name:"\u89c2\u5149\u8def\u7ebf",description:"<p>\u89c2\u5149\u8def\u7ebf</p>",availability:"".concat(n,"/").concat(i),point:{pixelSize:0,color:{rgba:[0,0,0,0]}},viewFrom:{cartesian:t},position:{epoch:n,cartographicDegrees:E(e)}}]}function E(e){return e.flatMap((function(e,t){return[20*t/C,w.b.Math.toDegrees(e.longitude),w.b.Math.toDegrees(e.latitude),e.height+100]}))}var F=function(e){Object(v.a)(r,e);var t=Object(h.a)(r);function r(){var e;Object(p.a)(this,r);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).setView=function(){var t;e.viewer.camera.setView({destination:(t=w.b.Cartesian3).fromDegrees.apply(t,x.concat([2e3])),orientation:{heading:w.b.Math.toRadians(0),pitch:w.b.Math.toRadians(-90),roll:w.b.Math.toRadians(0)}})},e.draw=function(){if(D.length){var t=e.viewer,r=t.clock,a=t.scene;r.clockStep=w.b.ClockStep.SYSTEM_CLOCK,e.path=a.groundPrimitives.add(new w.b.PrimitiveCollection);var n=0,i=w.b.JulianDate.now();o(i,M);e.loadCZML(!0),r.onTick.addEventListener((function t(r){w.b.JulianDate.greaterThanOrEquals(r.currentTime,i)&&(n<C?(e.path.add(new w.b.GroundPolylinePrimitive({geometryInstances:new w.b.GeometryInstance({geometry:new w.b.GroundPolylineGeometry({positions:[j[n],j[n+1]],width:6,vertexFormat:w.b.PolylineColorAppearance.VERTEX_FORMAT}),attributes:{color:w.b.ColorGeometryInstanceAttribute.fromColor(new w.b.Color(0,0,1,1))}}),appearance:new w.b.PolylineColorAppearance({translucent:!1})})),n++,o(i,M)):r.onTick.removeEventListener(t))}))}function o(e,t){return w.b.JulianDate.addSeconds(e,t,e)}},e.clearPrevDataSource=function(){e.ds&&(e.viewer.dataSources.remove(e.ds,!0),e.viewer.trackedEntity=void 0)},e.loadCZML=function(){var t=Object(d.a)(l.a.mark((function t(r){var a,n,i,o,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.clearPrevDataSource(),n=r?D:Object(u.a)(D).reverse(),i=r?[P,O]:[O,P],o=(a=e).getXYZ.apply(a,i),console.log(o),t.prev=5,t.next=8,e.viewer.dataSources.add(w.b.CzmlDataSource.load(T(n,o)));case 8:e.ds=t.sent,c=e.ds.entities.getById("path"),e.viewer.zoomTo(c),e.viewer.trackedEntity=c,t.next=18;break;case 14:t.prev=14,t.t0=t.catch(5),console.error(t.t0),e.flyTo(r);case 18:case"end":return t.stop()}}),t,null,[[5,14]])})));return function(e){return t.apply(this,arguments)}}(),e.getPathPositions=Object(d.a)(l.a.mark((function t(){var r,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=j.map((function(e){return w.b.Cartographic.fromCartesian(e)})),t.next=4,w.b.sampleTerrain(e.viewer.terrainProvider,12,r);case 4:return a=t.sent,D=Object(u.a)(a),e.setState({viewDisabled:!1}),console.log("_positions ready"),t.abrupt("return",j);case 11:return t.prev=11,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return",[]);case 15:case"end":return t.stop()}}),t,null,[[0,11]])}))),e.getXYZ=function(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-45,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3,i=e.getLocalPositions(t,r),o=Object(c.a)(i,2),s=o[0],l=o[1],u=e.getHeadingDegree(s.x,s.y,l.x,l.y),d=l.x-s.x,p=l.y-s.y,b=n*Math.abs(Math.sin(u))*(d>0?-1:1),v=n*Math.abs(Math.cos(u))*(p>0?-1:1),h=n/Math.abs(Math.tan(a));return s.x+=b,s.y+=v,s.z+=h,[b,v,h]},e.getLocalPositions=function(e,t){var r=w.b.Transforms.eastNorthUpToFixedFrame(e),a=w.b.Matrix4.inverse(r,new w.b.Matrix4);return[w.b.Matrix4.multiplyByPoint(a,e,new w.b.Cartesian3),w.b.Matrix4.multiplyByPoint(a,t,new w.b.Cartesian3)]},e.getHeadingDegree=function(e,t,r,a){var n=r-e,i=a-t;if(0===n)return i>=0?0:180;if(0===i)return n>0?90:-90;var o=(r-e)/(a-t),c=Math.atan(o)/Math.PI*180;if(i>0)return c;var s=r-e>0?1:-1;return(180-Math.abs(c))*s},e}return Object(b.a)(r,[{key:"componentDidMount",value:function(){this.viewer=new w.b.Viewer("stage",{terrainProvider:w.b.createWorldTerrain(),shouldAnimate:!0}),new w.a(this.viewer,{}),this.viewer.scene.debugShowFramesPerSecond=!0,this.getPathPositions()}},{key:"render",value:function(){return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)("div",{className:"toolbar",children:[Object(y.jsx)(o.a,{type:"primary",className:"vtb",onClick:this.setView,children:"Set View"}),Object(y.jsx)(o.a,{type:"primary",className:"vtb",onClick:this.draw,children:"Draw path"})]}),Object(y.jsx)("div",{id:"stage"})]})}}]),r}(m.Component);t.default=F}}]);