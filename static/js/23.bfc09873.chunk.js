(this["webpackJsonplearn-cesium"]=this["webpackJsonplearn-cesium"]||[]).push([[23],{128:function(e,t,r){"use strict";r.r(t),r.d(t,"Path",(function(){return L}));r(268);for(var a,n,i=r(272),o=r.n(i),c=r(298),s=r(257),u=r.n(s),l=r(297),d=r(259),p=r(85),v=r(86),b=r(87),h=r(88),m=r(11),g=r(84),w=r(271),f=r.n(w),y=r(23),M=300,x=20/M,P=[117.128202,36.209944],j=(a=g.b.Cartesian3).fromDegrees.apply(a,P),C=(n=g.b.Cartesian3).fromDegrees.apply(n,[117.109628,36.257021]),D=[],O=[],S=0;S<=M;++S){var k=S/M;D.push(g.b.Cartesian3.lerp(j,C,k,new g.b.Cartesian3))}function T(e,t){var r=f()(),a=r.clone().add(20,"s"),n=r.toISOString(),i=a.toISOString();return[{id:"document",name:"\u89c2\u5149\u8def\u7ebf",version:"1.0",clock:{interval:"".concat(n,"/").concat(i),currentTime:n,multiplier:1,range:"UNBOUNDED"}},{id:"path",name:"\u89c2\u5149\u8def\u7ebf",description:"<p>\u89c2\u5149\u8def\u7ebf</p>",availability:"".concat(n,"/").concat(i),point:{pixelSize:0,color:{rgba:[0,0,0,0]}},viewFrom:{cartesian:t},position:{epoch:n,cartographicDegrees:E(e)}}]}function E(e){return e.flatMap((function(e,t){return[20*t/M,g.b.Math.toDegrees(e.longitude),g.b.Math.toDegrees(e.latitude),e.height+100]}))}var L=function(e){Object(b.a)(r,e);var t=Object(h.a)(r);function r(){var e;Object(p.a)(this,r);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).setView=function(){var t;e.viewer.camera.setView({destination:(t=g.b.Cartesian3).fromDegrees.apply(t,P.concat([2e3])),orientation:{heading:g.b.Math.toRadians(0),pitch:g.b.Math.toRadians(-90),roll:g.b.Math.toRadians(0)}})},e.draw=function(){if(O.length){var t=e.viewer,r=t.clock,a=t.scene;r.clockStep=g.b.ClockStep.SYSTEM_CLOCK,e.path=a.groundPrimitives.add(new g.b.PrimitiveCollection);var n=0,i=g.b.JulianDate.now();o(i,x);e.loadCZML(!0),r.onTick.addEventListener((function t(r){g.b.JulianDate.greaterThanOrEquals(r.currentTime,i)&&(n<M?(e.path.add(new g.b.GroundPolylinePrimitive({geometryInstances:new g.b.GeometryInstance({geometry:new g.b.GroundPolylineGeometry({positions:[D[n],D[n+1]],width:6})})})),n++,o(i,x)):r.onTick.removeEventListener(t))}))}function o(e,t){return g.b.JulianDate.addSeconds(e,t,e)}},e.clearPrevDataSource=function(){e.ds&&(e.viewer.dataSources.remove(e.ds,!0),e.viewer.trackedEntity=void 0)},e.loadCZML=function(){var t=Object(d.a)(u.a.mark((function t(r){var a,n,i,o,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.clearPrevDataSource(),n=r?O:Object(l.a)(O).reverse(),i=r?[j,C]:[C,j],o=(a=e).getXYZ.apply(a,i),console.log(o),t.prev=5,t.next=8,e.viewer.dataSources.add(g.b.CzmlDataSource.load(T(n,o)));case 8:e.ds=t.sent,c=e.ds.entities.getById("path"),e.viewer.zoomTo(c),e.viewer.trackedEntity=c,t.next=18;break;case 14:t.prev=14,t.t0=t.catch(5),console.error(t.t0),e.flyTo(r);case 18:case"end":return t.stop()}}),t,null,[[5,14]])})));return function(e){return t.apply(this,arguments)}}(),e.getPathPositions=Object(d.a)(u.a.mark((function t(){var r,a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=D.map((function(e){return g.b.Cartographic.fromCartesian(e)})),t.next=4,g.b.sampleTerrain(e.viewer.terrainProvider,12,r);case 4:return a=t.sent,O=Object(l.a)(a),e.setState({viewDisabled:!1}),console.log("_positions ready"),t.abrupt("return",D);case 11:return t.prev=11,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return",[]);case 15:case"end":return t.stop()}}),t,null,[[0,11]])}))),e.getXYZ=function(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-45,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3,i=e.getLocalPositions(t,r),o=Object(c.a)(i,2),s=o[0],u=o[1],l=e.getHeadingDegree(s.x,s.y,u.x,u.y),d=u.x-s.x,p=u.y-s.y,v=n*Math.abs(Math.sin(l))*(d>0?-1:1),b=n*Math.abs(Math.cos(l))*(p>0?-1:1),h=n/Math.abs(Math.tan(a));return s.x+=v,s.y+=b,s.z+=h,[v,b,h]},e.getLocalPositions=function(e,t){var r=g.b.Transforms.eastNorthUpToFixedFrame(e),a=g.b.Matrix4.inverse(r,new g.b.Matrix4);return[g.b.Matrix4.multiplyByPoint(a,e,new g.b.Cartesian3),g.b.Matrix4.multiplyByPoint(a,t,new g.b.Cartesian3)]},e.getHeadingDegree=function(e,t,r,a){var n=r-e,i=a-t;if(0===n)return i>=0?0:180;if(0===i)return n>0?90:-90;var o=(r-e)/(a-t),c=Math.atan(o)/Math.PI*180;if(i>0)return c;var s=r-e>0?1:-1;return(180-Math.abs(c))*s},e}return Object(v.a)(r,[{key:"componentDidMount",value:function(){this.viewer=new g.b.Viewer("stage",{terrainProvider:g.b.createWorldTerrain(),shouldAnimate:!0}),new g.a(this.viewer,{}),this.viewer.scene.debugShowFramesPerSecond=!0,this.getPathPositions()}},{key:"render",value:function(){return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)("div",{className:"toolbar",children:[Object(y.jsx)(o.a,{type:"primary",className:"vtb",onClick:this.setView,children:"Set View"}),Object(y.jsx)(o.a,{type:"primary",className:"vtb",onClick:this.draw,children:"Draw path"})]}),Object(y.jsx)("div",{id:"stage"})]})}}]),r}(m.Component);t.default=L}}]);